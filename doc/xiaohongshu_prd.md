# 小红书选书工具 - 产品需求文档 (PRD)

**文档版本**: v1.0
**创建日期**: 2026-02-26
**项目**: BookRank 小红书选书功能扩展
**作者**: BookRank开发团队

---

## 1. 项目背景

### 1.1 业务背景

小红书外文书店目前面临以下痛点：

| 痛点 | 现状 | 影响 |
|------|------|------|
| 手动处理效率低 | 人工逐本查询ISBN、获取简介 | 44本书需要数小时 |
| 翻译依赖外部工具 | 复制到Google翻译再粘贴回Excel | 繁琐易错 |
| 数据分散 | 亚马逊链接、简介、翻译分散在多处 | 难以统一管理 |
| 无法批量处理 | 一次只能处理一本 | 效率低下 |

### 1.2 现有解决方案

现有「小红书选书工具」是一个本地Python脚本，功能如下：

```
输入: Excel文件 (ISBN-13列)
  │
  ├─► ISBN-13 → ISBN-10 转换
  │
  ├─► 生成亚马逊UK链接
  │
  ├─► 获取英文简介 (亚马逊HTML / Google Books)
  │
  ├─► Google翻译英译中
  │
  ▼
输出: 新Excel文件 (增加4列)
  - Q列: ISBN-10
  - R列: 亚马逊链接
  - S列: 英文简介
  - T列: 中文简介
```

**测试结果**：
- 处理44本书，成功获取简介37本（84%）
- 平均每本处理时间约30秒

### 1.3 问题

现有方案的局限性：

1. **本地运行**：需要安装Python环境，技术门槛高
2. **无法复用**：每次使用需重新运行脚本
3. **无状态记录**：处理历史无法保存
4. **无错误恢复**：中断后需重新开始

---

## 2. 产品目标

### 2.1 核心目标

将小红书选书工具**Web化**，用户只需：

1. 📤 **上传Excel** - 拖拽上传即可
2. ⚡ **一键处理** - 自动完成所有转换
3. 💾 **下载结果** - 获得处理后的完整Excel

### 2.2 用户价值

| 用户 | 价值 |
|------|------|
| 书店员工 | 无需Python知识，浏览器即可使用 |
| 书店老板 | 处理效率提升10倍以上 |
| 运营人员 | 批量处理历史可追溯 |

---

## 3. 功能需求

### 3.1 功能列表

| 功能 | 优先级 | 描述 |
|------|--------|------|
| F1. Excel上传 | P0 | 支持.xlsx/.xls格式，拖拽上传 |
| F2. ISBN转换 | P0 | 自动识别ISBN-13，转换为ISBN-10 |
| F3. 亚马逊链接 | P0 | 生成amazon.co.uk商品链接 |
| F4. 简介获取 | P0 | 自动从亚马逊/Google Books获取英文简介 |
| F5. AI翻译 | P0 | 使用智谱AI翻译为中文 |
| F6. Excel导出 | P0 | 下载包含所有数据的新Excel |
| F7. 处理进度 | P1 | 实时显示处理进度和状态 |
| F8. 处理历史 | P2 | 查看历史处理记录 |

### 3.2 详细功能说明

#### F1. Excel上传

- 支持格式：`.xlsx`, `.xls`
- 文件大小限制：10MB
- 表格要求：
  - 必须包含 `ISBN-13` 或 `ISBN` 列
  - 可选：`书名`、`作者` 列（用于匹配）
- 预览功能：上传后显示前5行数据

#### F2. ISBN转换

- 输入：13位ISBN（如 `9781035024377`）
- 输出：10位ISBN（如 `1035024371`）
- 算法：提取第4-12位 + 校验码计算
- 验证：校验ISBN-13格式，错误则跳过

#### F3. 亚马逊链接

- 格式：`https://www.amazon.co.uk/dp/{ISBN-10}`
- 可选：美国站 `https://www.amazon.com/dp/{ISBN-10}`
- 防封：添加随机延迟，避免请求过快

#### F4. 简介获取

获取策略（按优先级）：

```
1. 亚马逊HTML解析
   - 目标：bookDescription_feature_div
   - 来源：Scrape.do API 或 爬虫

2. Google Books API (备选)
   - 接口：googleapis.com/books/v1/volumes
   - 优势：稳定免费

3. Open Library (兜底)
   - 接口：openlibrary.org/api/books
```

#### F5. AI翻译

- 翻译引擎：**智谱AI GLM-4-Flash**（免费额度）
- 已集成到BookRank，直接调用
- 缓存机制：相同内容不重复翻译

#### F6. Excel导出

输出表格结构：

| 列号 | 列名 | 数据来源 | 说明 |
|------|------|----------|------|
| A-N | (原始列) | 输入文件 | 保持不变 |
| **O** | **ISBN-10** | 转换得到 | 10位书号 |
| **P** | **亚马逊链接** | 生成得到 | UK站链接 |
| **Q** | **英文简介** | 亚马逊/Google | 原文保留 |
| **R** | **中文简介** | AI翻译 | 中文对照 |

### 3.3 用户流程

```
┌──────────────────────────────────────────────────────────────┐
│                         用户流程                              │
└──────────────────────────────────────────────────────────────┘

  步骤1: 访问页面
  ┌─────────────────┐
  │  小红书选书工具  │ ◄─── 新增导航入口
  └────────┬────────┘
           │
  步骤2: 上传Excel
  ┌─────────────────┐
  │  📤 拖拽上传    │ ◄─── 支持.xlsx/.xls
  │  或 点击选择    │
  └────────┬────────┘
           │
  步骤3: 预览确认
  ┌─────────────────┐
  │ 显示前5行数据    │ ◄─── 确认格式正确
  │ ISBN: 978...    │
  └────────┬────────┘
           │
  步骤4: 开始处理
  ┌─────────────────┐
  │ ⚡ 正在处理...  │ ◄─── 显示进度条
  │  [████░░] 40%  │
  │  已处理: 18/44  │
  └────────┬────────┘
           │
  步骤5: 完成下载
  ┌─────────────────┐
  │ ✅ 处理完成!    │
  │ 💾 下载Excel   │ ◄─── 包含Q-R列
  └─────────────────┘
```

### 3.4 页面设计

#### 页面1: 上传页面 (xiaohongshu.html)

```
┌─────────────────────────────────────────────────────────────┐
│  📚 小红书选书工具                              BookRank    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │                                                      │   │
│   │              📤 拖拽Excel文件到此处               │   │
│   │                                                      │   │
│   │              或 点击选择文件                        │   │
│   │                                                      │   │
│   │         支持 .xlsx / .xls  (最大10MB)            │   │
│   │                                                      │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
│   📋 表格要求：                                            │
│   • 必须包含 ISBN-13 或 ISBN 列                           │
│   • 可选包含 书名、作者 列                                │
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  预览数据                                            │   │
│   │  ─────────────────────────────────                 │   │
│   │  ISBN-13         书名                    作者       │   │
│   │  9781035024377   The Impossible...   作者A       │   │
│   │  9781234567890   Another Book        作者B       │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
│                        [ ⚡ 开始处理 ]                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 页面2: 处理页面 (xiaohongshu_progress.html)

```
┌─────────────────────────────────────────────────────────────┐
│  📚 小红书选书工具                              BookRank    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  处理进度                                            │   │
│   │  ─────────────────────────────────                 │   │
│   │                                                      │   │
│   │  ████████████████████░░░░░░░░░░░  65%             │   │
│   │                                                      │   │
│   │  已处理: 29 / 44 本                                 │   │
│   │  预计剩余: 45秒                                     │   │
│   │                                                      │   │
│   │  当前处理: The Impossible...                         │   │
│   │  ✓ ISBN转换成功                                     │   │
│   │  ✓ 获取简介成功                                     │   │
│   │  ✓ 翻译完成                                         │   │
│   │                                                      │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
│   📊 处理统计:                                             │
│   • 成功: 29 本                                           │
│   • 失败: 0 本                                            │
│   • 缓存命中: 5 本                                         │
│                                                             │
│                        [ ⬇️ 下载结果 ]                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 技术方案

### 4.1 系统架构

```
┌────────────────────────────────────────────────────────────────┐
│                        用户层                                   │
│   PC浏览器 / 移动端浏览器                                       │
└────────────────────────────┬───────────────────────────────────┘
                             │
┌────────────────────────────▼───────────────────────────────────┐
│                       Web层                                     │
│   ┌──────────────────┐  ┌──────────────────┐                 │
│   │ 上传页面         │  │ 处理进度页面      │                 │
│   │ xiaohongshu.html │  │ progress.html    │                 │
│   └────────┬─────────┘  └────────┬─────────┘                 │
│            │                     │                            │
│            └──────────┬─────────┘                            │
│                       ▼                                       │
│            ┌──────────────────────┐                          │
│            │   小红书API端点     │                          │
│            │   /xiaohongshu/*    │                          │
│            └──────────┬───────────┘                          │
└───────────────────────┼──────────────────────────────────────┘
                        │
┌───────────────────────▼──────────────────────────────────────┐
│                      服务层                                     │
│   ┌───────────────────┐  ┌───────────────────┐              │
│   │ Excel处理服务      │  │ 翻译服务          │              │
│   │ pandas + openpyxl │  │ 智谱AI (已有)    │              │
│   └─────────┬─────────┘  └─────────┬─────────┘              │
│             │                      │                        │
│   ┌────────▼─────────┐  ┌────────▼─────────┐              │
│   │ ISBN转换服务      │  │ 简介获取服务    │              │
│   │ (新编写)          │  │ Google Books    │              │
│   └───────────────────┘  └───────────────────┘              │
└──────────────────────────────────────────────────────────────┘
```

### 4.2 技术栈

| 层级 | 技术 | 说明 |
|------|------|------|
| 后端 | Flask 2.3 | 现有框架 |
| 前端 | Jinja2 + JS | 现有技术栈 |
| Excel处理 | pandas + openpyxl | 新增依赖 |
| 翻译 | 智谱AI | 已有，集成 |
| 简介获取 | Google Books API | 已有，集成 |
| 缓存 | SQLite | 已有，集成 |

### 4.3 数据流程

```
Excel上传
    │
    ▼
┌─────────────────┐
│  读取数据       │ ◄─── pandas.read_excel()
│  验证ISBN       │
└────────┬────────┘
         │
         ▼ 循环处理每本书
    ┌────┴────┐
    │         │
    ▼         ▼
┌─────────┐ ┌─────────┐
│ 检查缓存 │ │ 新建任务│
│(API缓存) │ │         │
└────┬────┘ └────┬────┘
     │           │
     ▼           ▼
┌─────────────────┐
│ 获取简介        │ ◄─── Google Books API
│ (已有服务)     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ AI翻译          │ ◄─── 智谱AI (已有)
│ (已有服务)     │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 保存到缓存      │
└────────┬────────┘
         │
         ▼ 循环结束
┌─────────────────┐
│ 生成新Excel     │ ◄─── pandas.to_excel()
│ 下载            │
└─────────────────┘
```

### 4.4 依赖更新

需要在 `requirements.txt` 添加：

```txt
pandas>=2.0.0        # Excel处理
openpyxl>=3.1.0      # Excel写入
```

---

## 5. 实施计划

### 5.1 开发阶段

| 阶段 | 任务 | 工期 | 交付物 |
|------|------|------|--------|
| **Phase 1** | 基础功能 | 2天 | |
| 1.1 | ISBN转换服务 | 0.5天 | `isbn_service.py` |
| 1.2 | Excel上传功能 | 0.5天 | 上传页面+API |
| 1.3 | 核心处理逻辑 | 1天 | `xiaohongshu_service.py` |
| **Phase 2** | 增强功能 | 1天 | |
| 2.1 | 进度显示 | 0.5天 | WebSocket/轮询 |
| 2.2 | 下载功能 | 0.5天 | Excel导出 |
| **Phase 3** | 完善 | 0.5天 | |
| 3.1 | 处理历史 | 0.25天 | 历史记录页面 |
| 3.2 | 测试优化 | 0.25天 | Bug修复 |

**总工期：3.5天 (~1周)**

### 5.2 里程碑

| 里程碑 | 目标 | 验收标准 |
|--------|------|----------|
| M1 | Day 2 | 能上传Excel并成功转换ISBN |
| M2 | Day 3 | 能获取简介并翻译，生成完整Excel |
| M3 | Day 4 | 完整功能可用，UI完善 |

---

## 6. 成本估算

### 6.1 开发成本

| 成本项 | 估算 |
|--------|------|
| 开发人力 | 3.5人日 |
| 测试人力 | 1人日 |
| **合计** | **4.5人日** |

### 6.2 运营成本（预估）

| 资源 | 月消耗 | 说明 |
|------|--------|------|
| 智谱AI翻译 | 免费额度 | GLM-4-Flash免费 |
| Google Books | 免费 | 无限制 |
| 服务器资源 | 现有 | 无额外成本 |
| **合计** | **¥0/月** | 现有免费额度足够 |

---

## 7. 风险与对策

| 风险 | 等级 | 对策 |
|------|------|------|
| 亚马逊反爬 | 中 | 以Google Books为主力数据源 |
| 大文件超时 | 中 | 分批处理，设置超时重试 |
| Excel格式多样 | 中 | 严格格式要求，提供模板 |
| API限流 | 低 | 已有缓存机制复用 |

---

## 8. 成功指标

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| 处理成功率 | ≥85% | 成功处理数/总数 |
| 平均处理时间 | <1秒/本 | 不含API等待 |
| 用户满意度 | >4.5/5 | 反馈调查 |
| 日处理量 | >500本 | 系统统计 |

---

## 9. 总结

### 9.1 项目价值

- ✅ **高复用**：70%代码来自现有服务
- ✅ **低成本**：无需额外API费用
- ✅ **高效率**：处理时间减少90%
- ✅ **易用性**：零技术门槛，浏览器即用

### 9.2 下一步

**确认后即可启动开发，预计4天完成上线。**

---

*文档结束*

# 小红书选书工具 - 产品需求文档 (PRD)

**文档版本**: v1.1
**创建日期**: 2026-02-26
**项目**: BookRank 小红书选书功能扩展
**作者**: BookRank开发团队

---

## 1. 项目背景

### 1.1 业务背景

小红书外文书店目前面临以下痛点：

| 痛点 | 现状 | 影响 |
|------|------|------|
| 手动处理效率低 | 人工逐本查询ISBN、获取简介 | 44本书需要数小时 |
| 翻译依赖外部工具 | 复制到Google翻译再粘贴回Excel | 繁琐易错 |
| 数据分散 | 亚马逊链接、简介、翻译分散在多处 | 难以统一管理 |
| 无法批量处理 | 一次只能处理一本 | 效率低下 |
| 小红书文案耗时 | 人工逐本编写种草文案 | 耗时且风格不统一 |

### 1.2 现有解决方案

现有「小红书选书工具」是一个本地Python脚本，功能如下：

```
输入: Excel文件 (ISBN-13列)
  │
  ├─► ISBN-13 → ISBN-10 转换
  │
  ├─► 生成亚马逊UK链接
  │
  ├─► 获取英文简介 (亚马逊HTML / Google Books)
  │
  ├─► Google翻译英译中
  │
  ▼
输出: 新Excel文件 (增加4列)
  - Q列: ISBN-10
  - R列: 亚马逊链接
  - S列: 英文简介
  - T列: 中文简介
```

**测试结果**：
- 处理44本书，成功获取简介37本（84%）
- 平均每本处理时间约30秒

### 1.3 问题

现有方案的局限性：

1. **本地运行**：需要安装Python环境，技术门槛高
2. **无法复用**：每次使用需重新运行脚本
3. **无状态记录**：处理历史无法保存
4. **无错误恢复**：中断后需重新开始

---

## 2. 产品目标

### 2.1 核心目标

将小红书选书工具**Web化**，用户只需：

1. 📤 **上传Excel** - 拖拽上传即可
2. ⚡ **一键处理** - 自动完成所有转换
3. 💾 **下载结果** - 获得处理后的完整Excel

### 2.2 用户价值

| 用户 | 价值 |
|------|------|
| 书店员工 | 无需Python知识，浏览器即可使用 |
| 书店老板 | 处理效率提升10倍以上 |
| 运营人员 | 批量处理历史可追溯 |
| 小红书运营 | 自动生成种草文案，风格统一 |

---

## 3. 功能需求

### 3.1 功能列表

| 功能 | 优先级 | 描述 |
|------|--------|------|
| F1. Excel上传 | P0 | 支持.xlsx/.xls格式，拖拽上传 |
| F2. 智能表格识别 | P0 | 自动识别ISBN-13/ISBN列，无需手动指定列名 |
| F3. ISBN转换 | P0 | 自动识别ISBN-13，转换为ISBN-10 |
| F4. 亚马逊链接 | P0 | 生成amazon.co.uk商品链接 |
| F5. 亚马逊信息获取 | P0 | 从亚马逊获取书名、作者、出版社、图书简介（原版英文） |
| F6. AI翻译 | P0 | 使用智谱AI翻译为中文 |
| F7. 小红书文案生成 | P0 | 根据图书信息AI生成种草文案（模仿上海外文书店风格） |
| F8. Excel导出 | P0 | 下载包含所有数据的新Excel |
| F9. 处理进度 | P1 | 实时显示处理进度和状态 |
| F10. 处理历史 | P2 | 轻量级历史记录（JSON文件存储，不占数据库） |

### 3.2 详细功能说明

#### F1. Excel上传

- 支持格式：`.xlsx`, `.xls`
- 文件大小限制：10MB
- **智能表格识别**（F2）：
  - 自动识别 `ISBN-13`、`ISBN`、`isbn13`、`ISBN-13列` 等列名变体
  - 无需用户手动指定列名
  - 支持多Sheet自动读取第一个有数据的Sheet
- 预览功能：上传后显示前5行数据，自动标识别别的ISBN列

#### F2. ISBN转换

- 输入：13位ISBN（如 `9781035024377`）
- 输出：10位ISBN（如 `1035024371`）
- 算法：提取第4-12位 + 校验码计算
- 验证：校验ISBN-13格式，错误则跳过并记录日志

#### F3. 亚马逊链接

- 格式：`https://www.amazon.co.uk/dp/{ISBN-10}`
- 可选：美国站 `https://www.amazon.com/dp/{ISBN-10}`
- 防封：添加随机延迟（1-3秒），避免请求过快

#### F4. 亚马逊信息获取（核心功能）

**数据获取优先级**：
```
1. 亚马逊商品页爬取（优先）
   - 来源：amazon.co.uk 商品详情页
   - 工具：**Scrape.do API**（付费代理，稳定可靠）
   - 数据：书名、作者、出版社、图书简介、封面图片URL
   - 费用：约 $15/月（10000次请求）

2. Google Books API（备选）
   - 接口：googleapis.com/books/v1/volumes
   - 数据：书名、作者、出版社、简介
   - 优势：稳定免费

3. Open Library（兜底）
   - 接口：openlibrary.org/api/books
   - 数据：基础图书信息
```

**获取字段**：
| 字段 | 来源 | 说明 |
|------|------|------|
| 书名 | 亚马逊/Google Books | 英文原名 |
| 作者 | 亚马逊/Google Books | 多作者用逗号分隔 |
| 出版社 | 亚马逊/Google Books | 英文原版出版社 |
| 图书简介 | 亚马逊/Google Books | 英文原版简介 |
| 封面图片 | 亚马逊 | 大封面图URL |

#### F5. AI翻译

- 翻译引擎：**智谱AI GLM-4-Flash**（免费额度）
- 已集成到BookRank，直接调用
- 缓存机制：相同内容不重复翻译
- 翻译字段：
  - 书名 → 中文书名
  - 作者 → 中文作者名
  - 图书简介 → 中文简介
  - 出版社 → 中文出版社名

#### F6. 小红书文案生成（核心功能）

**文案风格**：模仿「上海外文书店」小红书账号风格
- 特点：文艺清新、温柔种草、情感共鸣
- 结构：故事引入 + 书籍推荐 + 个人感悟

**AI生成 Prompt**：
```
你是一位小红书读书博主。请根据以下书籍信息，生成一篇种草笔记。

书籍信息：
- 书名：{书名}
- 作者：{作者}
- 出版社：{出版社}
- 简介：{简介}

要求：
1. 开头用一句话故事引入（如：在福州路的某个下午...）
2. 介绍书籍核心卖点（2-3句话）
3. 适合人群推荐
4. 结尾引导互动（"评论区告诉我..."）
5. 总字数控制在150-300字
6. 语气温柔真诚，不夸大
7. 适当添加1-2个emoji
```

**输出位置**：放在Excel的独立列中，方便复制到小红书发布

#### F7. Excel导出

输出表格结构：

| 列号 | 列名 | 数据来源 | 说明 |
|------|------|----------|------|
| A-N | (原始列) | 输入文件 | 保持不变 |
| **O** | **ISBN-10** | 转换得到 | 10位书号 |
| **P** | **亚马逊链接** | 生成得到 | UK站链接 |
| **Q** | **书名(英)** | 亚马逊获取 | 英文原名 |
| **R** | **作者(英)** | 亚马逊获取 | 英文作者名 |
| **S** | **出版社(英)** | 亚马逊获取 | 英文出版社 |
| **T** | **图书简介(英)** | 亚马逊获取 | 英文原文简介 |
| **U** | **书名(中)** | AI翻译 | 中文翻译 |
| **V** | **作者(中)** | AI翻译 | 中文翻译 |
| **W** | **出版社(中)** | AI翻译 | 中文翻译 |
| **X** | **图书简介(中)** | AI翻译 | 中文翻译 |
| **Y** | **小红书文案** | AI生成 | 种草笔记文案 |
| **Z** | **封面图片URL** | 亚马逊获取 | 可用于配图 |

### 3.3 用户流程

```
┌──────────────────────────────────────────────────────────────┐
│                         用户流程                              │
└──────────────────────────────────────────────────────────────┘

  步骤1: 访问页面
  ┌─────────────────┐
  │  小红书选书工具  │ ◄─── 新增导航入口
  └────────┬────────┘
           │
  步骤2: 上传Excel
  ┌─────────────────┐
  │  📤 拖拽上传    │ ◄─── 支持.xlsx/.xls
  │  或 点击选择    │
  └────────┬────────┘
           │
  步骤3: 预览确认
  ┌─────────────────┐
  │ 显示前5行数据    │ ◄─── 确认格式正确
  │ ISBN: 978...    │
  └────────┬────────┘
           │
  步骤4: 开始处理
  ┌─────────────────┐
  │ ⚡ 正在处理...  │ ◄─── 显示进度条
  │  [████░░] 40%  │
  │  已处理: 18/44  │
  └────────┬────────┘
           │
  步骤5: 完成下载
  ┌─────────────────┐
  │ ✅ 处理完成!    │
  │ 💾 下载Excel   │ ◄─── 包含Q-R列
  └─────────────────┘
```

### 3.4 页面设计

#### 页面1: 上传页面 (xiaohongshu.html)

```
┌─────────────────────────────────────────────────────────────┐
│  📚 小红书选书工具                              BookRank    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │                                                      │   │
│   │              📤 拖拽Excel文件到此处               │   │
│   │                                                      │   │
│   │              或 点击选择文件                        │   │
│   │                                                      │   │
│   │         支持 .xlsx / .xls  (最大10MB)            │   │
│   │                                                      │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
│   📋 表格要求：                                            │
│   • 只需包含 ISBN 列（系统会自动识别）                     │
│   • 支持多种列名：ISBN-13、ISBN、isbn13 等                  │
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  预览数据                                            │   │
│   │  ─────────────────────────────────                 │   │
│   │  ISBN-13         书名                    作者       │   │
│   │  9781035024377   The Impossible...   作者A       │   │
│   │  9781234567890   Another Book        作者B       │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
│                        [ ⚡ 开始处理 ]                       │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

#### 页面2: 处理页面 (xiaohongshu_progress.html)

```
┌─────────────────────────────────────────────────────────────┐
│  📚 小红书选书工具                              BookRank    │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│   ┌─────────────────────────────────────────────────────┐   │
│   │  处理进度                                            │   │
│   │  ─────────────────────────────────                 │   │
│   │                                                      │   │
│   │  ████████████████████░░░░░░░░░░░  65%             │   │
│   │                                                      │   │
│   │  已处理: 29 / 44 本                                 │   │
│   │  预计剩余: 45秒                                     │   │
│   │                                                      │   │
│   │  当前处理: The Impossible...                         │   │
│   │  ✓ ISBN转换成功                                     │   │
│   │  ✓ 获取亚马逊信息成功                                │   │
│   │  ✓ AI翻译完成                                        │   │
│   │  ✓ 小红书文案生成                                    │   │
│   │                                                      │   │
│   └─────────────────────────────────────────────────────┘   │
│                                                             │
│   📊 处理统计:                                             │
│   • 成功: 29 本                                           │
│   • 失败: 0 本                                            │
│   • 缓存命中: 5 本                                         │
│                                                             │
│                        [ ⬇️ 下载结果 ]                      │
│                                                             │
└─────────────────────────────────────────────────────────────┘
```

---

## 4. 技术方案

### 4.1 系统架构

```
┌────────────────────────────────────────────────────────────────┐
│                        用户层                                   │
│   PC浏览器 / 移动端浏览器                                       │
└────────────────────────────┬───────────────────────────────────┘
                             │
┌────────────────────────────▼───────────────────────────────────┐
│                       Web层                                     │
│   ┌──────────────────┐  ┌──────────────────┐                 │
│   │ 上传页面         │  │ 处理进度页面      │                 │
│   │ xiaohongshu.html │  │ progress.html    │                 │
│   └────────┬─────────┘  └────────┬─────────┘                 │
│            │                     │                            │
│            └──────────┬─────────┘                            │
│                       ▼                                       │
│            ┌──────────────────────┐                          │
│            │   小红书API端点     │                          │
│            │   /xiaohongshu/*    │                          │
│            └──────────┬───────────┘                          │
└───────────────────────┼──────────────────────────────────────┘
                        │
┌───────────────────────▼──────────────────────────────────────┐
│                      服务层                                     │
│   ┌───────────────────┐  ┌───────────────────┐              │
│   │ Excel处理服务      │  │ 翻译服务          │              │
│   │ pandas + openpyxl │  │ 智谱AI (已有)    │              │
│   └─────────┬─────────┘  └─────────┬─────────┘              │
│             │                      │                        │
│   ┌────────▼─────────┐  ┌────────▼─────────┐              │
│   │  简介获取服务    │  │ Google Books    │              │
│   │  (亚马逊爬取)    │  │ Open Library   │              │
│   └───────────────────┘  └───────────────────┘              │
│                                                                              │
│   ┌───────────────────┐  ┌───────────────────┐                           │
│   │ 小红书文案生成    │  │ 缓存服务           │                           │
│   │ 智谱AI (已有)     │  │ SQLite JSON文件    │                           │
│   └───────────────────┘  └───────────────────┘                           │
└──────────────────────────────────────────────────────────────┘
```

### 4.2 技术栈

| 层级 | 技术 | 说明 |
|------|------|------|
| 后端 | Flask 2.3 | 现有框架 |
| 前端 | Jinja2 + JS | 现有技术栈 |
| Excel处理 | pandas + openpyxl | 新增依赖 |
| 亚马逊爬取 | Scrape.do API / 自建爬虫 | 优先获取数据 |
| 翻译 | 智谱AI | 已有，集成 |
| 小红书文案 | 智谱AI | 已有，集成 |
| 数据获取 | Google Books API + Open Library | 备选/兜底 |
| 缓存 | SQLite + JSON文件 | 轻量级存储 |

### 4.3 数据流程

```
Excel上传
    │
    ▼
┌─────────────────┐
│  读取数据       │ ◄─── pandas.read_excel()
│  智能识别ISBN列 │
└────────┬────────┘
         │
         ▼ 循环处理每本书
    ┌────┴────┐
    │         │
    ▼         ▼
┌─────────┐ ┌─────────┐
│ 检查缓存 │ │ 新建任务│
│(双通道)  │ │         │
└────┬────┘ └────┬────┘
     │           │
     │      ┌────▼────┐
     │      │         │
     │      ▼         ▼
     │ ┌─────────┐ ┌─────────────┐
     │ │ 亚马逊   │ │ Google Books │
     │ │ 爬取    │ │ API (备选)  │
     │ └────┬────┘ └──────┬──────┘
     │      │             │
     │      └──────┬──────┘
     │             │
     │        ┌────▼────┐
     │        │         │
     │        ▼         ▼
     │  ┌─────────┐ ┌─────────────┐
     │  │ Open    │ │ 均失败则    │
     │  │ Library │ │ 记录失败    │
     │  │ (兜底)  │ │             │
     │  └────┬────┘ └──────┬──────┘
     │       │             │
     └───────┼─────────────┘
             │
             ▼
┌─────────────────┐
│ AI翻译          │ ◄─── 智谱AI (已有)
│ (书名/作者/简介) │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 小红书文案生成  │ ◄─── 智谱AI
│ (风格化种草)   │
└────────┬────────┘
         │
         ▼
┌─────────────────┐
│ 保存到缓存      │ ◄─── SQLite + JSON
└────────┬────────┘
         │
         ▼ 循环结束
┌─────────────────┐
│ 生成新Excel     │ ◄─── pandas.to_excel()
│ 下载            │     包含12个新列
└─────────────────┘
```

**关键设计点**：
- 缓存策略：亚马逊数据（有效期30天）、翻译结果（永久）、文案（7天）
- 失败处理：某数据源失败自动切换备选，全部失败记录但继续处理下一本
- 并发控制：支持10本并行处理（可配置），避免API限流

### 4.4 依赖更新

需要在 `requirements.txt` 添加：

```txt
pandas>=2.0.0        # Excel处理
openpyxl>=3.1.0      # Excel写入
```

---

## 5. 实施计划

### 5.1 开发阶段

| 阶段 | 任务 | 工期 | 交付物 |
|------|------|------|--------|
| **Phase 1** | 基础功能 | 2.5天 | |
| 1.1 | 智能ISBN列识别 | 0.5天 | `excel_reader.py` |
| 1.2 | ISBN转换服务 | 0.25天 | `isbn_service.py` |
| 1.3 | Excel上传/预览 | 0.25天 | 上传页面+API |
| 1.4 | 亚马逊爬取服务 | 1天 | `amazon_scraper.py` |
| 1.5 | 核心处理逻辑 | 0.5天 | `xiaohongshu_service.py` |
| **Phase 2** | 翻译+文案 | 1天 | |
| 2.1 | 多字段翻译 | 0.25天 | 扩展翻译服务 |
| 2.2 | 小红书文案生成 | 0.5天 | 文案生成Prompt |
| 2.3 | 进度显示 | 0.25天 | WebSocket/轮询 |
| **Phase 3** | 导出+历史 | 0.5天 | |
| 3.1 | 12列Excel导出 | 0.25天 | 导出功能 |
| 3.2 | JSON历史记录 | 0.25天 | 轻量存储 |
| **Phase 4** | 完善 | 0.5天 | |
| 4.1 | 并发优化 | 0.25天 | 10本并行 |
| 4.2 | 测试/优化 | 0.25天 | Bug修复 |

**总工期：4.5天 (~1周半)**

### 5.2 里程碑

| 里程碑 | 目标 | 验收标准 |
|--------|------|----------|
| M1 | Day 2.5 | 能上传Excel并智能识别ISBN，成功获取亚马逊信息 |
| M2 | Day 3.5 | 能翻译+生成小红书文案，生成完整Excel |
| M3 | Day 5 | 完整功能可用，UI完善，并发处理正常 |

---

## 6. 成本估算

### 6.1 开发成本

| 成本项 | 估算 |
|--------|------|
| 开发人力 | 3.5人日 |
| 测试人力 | 1人日 |
| **合计** | **4.5人日** |

### 6.2 运营成本（预估）

| 资源 | 月消耗 | 说明 |
|------|--------|------|
| 智谱AI翻译 | 免费额度 | GLM-4-Flash免费 |
| Scrape.do | ¥100/月 | 约$15/月，10000次请求 |
| Google Books | 免费 | 无限制 |
| 服务器资源 | 现有 | 无额外成本 |
| **合计** | **¥100/月** | 主要是Scrape.do费用 |

> 预估处理量：500-1000本/月，Scrape.do 10000次/月足够使用

---

## 7. 风险与对策

| 风险 | 等级 | 对策 |
|------|------|------|
| 亚马逊反爬 | **高** | 使用Scrape.do API付费代理（已选定方案） |
| 亚马逊数据不准 | 中 | 多源交叉验证（与Google Books对比） |
| 大文件超时 | 中 | 分批处理+后台队列，设置超时重试 |
| Excel格式多样 | 中 | 智能列识别算法，支持多种列名变体 |
| API限流 | 中 | 并发控制(10本)+指数退避+缓存复用 |
| Render免费版限制 | 低 | 使用JSON文件存储历史，不占数据库 |

### 7.1 亚马逊数据准确性保障

为确保获取的亚马逊数据准确无误：
1. **多源对比**：获取亚马逊数据后，与Google Books进行交叉验证
2. **ISBN精准匹配**：确保返回的图书ISBN与查询ISBN完全一致
3. **数据清洗**：过滤HTML标签、异常字符、空描述
4. **兜底策略**：主源失败自动切换备选源，保证高成功率

---

## 8. 成功指标

| 指标 | 目标值 | 测量方法 |
|------|--------|----------|
| 处理成功率 | ≥85% | 成功处理数/总数 |
| 数据准确率 | ≥90% | 亚马逊数据与ISBN匹配率 |
| 小红书文案可用率 | ≥80% | 成功生成文案数/总数 |
| 平均处理时间 | <3秒/本 | 含API等待（并发10本） |
| 用户满意度 | >4.5/5 | 反馈调查 |
| 日处理量 | >500本 | 系统统计 |

---

## 9. 总结

### 9.1 项目价值

- ✅ **高复用**：70%代码来自现有服务
- ✅ **低成本**：月费约¥100（Scrape.do）
- ✅ **高效率**：处理时间减少90%
- ✅ **易用性**：零技术门槛，浏览器即用
- ✅ **可扩展**：预留飞书/Notion对接接口

### 9.2 功能扩展预留

**飞书/Notion对接接口设计**：
- API端点：`/xiaohongshu/export/{platform}`
- 支持平台：`feishu`、`notion`
- 数据格式：JSON格式输出
- 后续可快速对接实现自动化推送

### 9.3 下一步

**确认后即可启动开发，预计5天完成上线。**

---

*文档结束*

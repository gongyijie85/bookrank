option_settings:
  aws:elasticbeanstalk:container:python:
    WSGIPath: app:application  # 指向 app.py 中的 application 变量
  aws:elasticbeanstalk:environment:proxy:
    ProxyServer: nginx
  aws:elasticbeanstalk:command:
    Timeout: 300  # 增加超时设置，适应 API 请求延迟

files:
  "/etc/nginx/conf.d/timeout.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      proxy_connect_timeout 60s;
      proxy_read_timeout 300s;  # 延长读取超时，适应批量 API 请求
      proxy_send_timeout 60s;
      fastcgi_read_timeout 300s;
      proxy_next_upstream error timeout http_500 http_502 http_503 http_504;  # 增加故障转移

  "/etc/nginx/conf.d/staticfiles.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      location /static/ {
          alias /var/app/current/static/;
          expires 1d;
          add_header Cache-Control "public, max-age=86400";
          add_header Vary Accept-Encoding;  # 增加编码缓存控制
      }
      location /favicon.ico {
          alias /var/app/current/static/favicon.ico;
          expires 7d;
      }
      location /cache/images/ {
          alias /var/app/current/cache/images/;
          expires 1d;
          add_header Cache-Control "public, max-age=86400";
      }

  "/etc/nginx/conf.d/compression.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      gzip on;
      gzip_types text/css application/javascript application/json text/plain text/html application/xml image/svg+xml;
      gzip_comp_level 4;
      gzip_vary on;
      gzip_proxied any;

  "/etc/nginx/conf.d/encoding.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      charset utf-8;
      source_charset utf-8;
      client_header_buffer_size 16k;
      large_client_header_buffers 4 32k;
      client_body_timeout 60s;

  "/etc/nginx/conf.d/proxy_buffer.conf":
    mode: "000644"
    owner: root
    group: root
    content: |
      proxy_buffer_size 16k;
      proxy_buffers 4 64k;
      proxy_busy_buffers_size 128k;
      proxy_temp_file_write_size 128k;
      proxy_set_header Host $host;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $schem
